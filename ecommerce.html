<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Pipeline Capstone Project</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .pipeline-stages {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stage {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .stage:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }
        
        .stage h3 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stage-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }
        
        .ingest { background: #e53e3e; }
        .transform { background: #3182ce; }
        .analyze { background: #38a169; }
        .model { background: #805ad5; }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .file-input {
            margin-bottom: 15px;
        }
        
        .file-input input[type="file"] {
            display: none;
        }
        
        .file-input label {
            display: inline-block;
            background: #4299e1;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .file-input label:hover {
            background: #3182ce;
        }
        
        .output {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            min-height: 100px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            overflow-y: auto;
            max-height: 300px;
        }
        
        .chart-container {
            margin-top: 20px;
            height: 300px;
            position: relative;
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .metric {
            background: #edf2f7;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2d3748;
        }
        
        .metric-label {
            font-size: 0.9rem;
            color: #718096;
            margin-top: 5px;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .log {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Data Pipeline Capstone Project</h1>
            <p>Ingest ‚Üí Transform ‚Üí Analyze ‚Üí Model</p>
        </div>
        
        <div class="pipeline-stages">
            <!-- INGEST STAGE -->
            <div class="stage">
                <h3><span class="stage-icon ingest">1</span>Data Ingest</h3>
                <div class="file-input">
                    <label for="csvFile">üìÅ Upload CSV File</label>
                    <input type="file" id="csvFile" accept=".csv" />
                </div>
                <button onclick="generateSampleData()">Generate Sample Data</button>
                <button onclick="ingestData()" id="ingestBtn" disabled>Start Ingestion</button>
                <div class="progress-bar">
                    <div class="progress-fill" id="ingestProgress"></div>
                </div>
                <div class="output" id="ingestOutput">Upload a CSV file or generate sample data to begin...</div>
            </div>
            
            <!-- TRANSFORM STAGE -->
            <div class="stage">
                <h3><span class="stage-icon transform">2</span>Data Transform</h3>
                <div class="controls">
                    <button onclick="cleanData()" id="cleanBtn" disabled>Clean Data</button>
                    <button onclick="normalizeData()" id="normalizeBtn" disabled>Normalize</button>
                    <button onclick="createFeatures()" id="featureBtn" disabled>Engineer Features</button>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="transformProgress"></div>
                </div>
                <div class="output" id="transformOutput">Ready for data transformation...</div>
            </div>
            
            <!-- ANALYZE STAGE -->
            <div class="stage">
                <h3><span class="stage-icon analyze">3</span>Data Analysis</h3>
                <div class="controls">
                    <button onclick="exploreData()" id="exploreBtn" disabled>Explore Data</button>
                    <button onclick="visualizeData()" id="visualizeBtn" disabled>Create Visualizations</button>
                    <button onclick="generateStats()" id="statsBtn" disabled>Statistical Analysis</button>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="analyzeProgress"></div>
                </div>
                <div class="metrics" id="analysisMetrics"></div>
                <div class="chart-container">
                    <canvas id="analysisChart"></canvas>
                </div>
            </div>
            
            <!-- MODEL STAGE -->
            <div class="stage">
                <h3><span class="stage-icon model">4</span>ML Modeling</h3>
                <div class="controls">
                    <button onclick="prepareModel()" id="prepareBtn" disabled>Prepare Model</button>
                    <button onclick="trainModel()" id="trainBtn" disabled>Train Model</button>
                    <button onclick="evaluateModel()" id="evaluateBtn" disabled>Evaluate</button>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="modelProgress"></div>
                </div>
                <div class="metrics" id="modelMetrics"></div>
                <div class="chart-container">
                    <canvas id="modelChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="log" id="pipelineLog">
            Pipeline Log:
            Ready to start data pipeline...
        </div>
    </div>

    <script>
        // Global variables
        let rawData = [];
        let cleanedData = [];
        let transformedData = [];
        let analysisResults = {};
        let modelResults = {};
        
        // Logging function
        function log(message) {
            const logElement = document.getElementById('pipelineLog');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `\n[${timestamp}] ${message}`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        // Progress bar animation
        function updateProgress(progressId, percentage) {
            document.getElementById(progressId).style.width = percentage + '%';
        }
        
        // Generate sample e-commerce data
        function generateSampleData() {
            log('Generating sample e-commerce dataset...');
            
            const products = ['Laptop', 'Phone', 'Tablet', 'Headphones', 'Watch', 'Camera'];
            const categories = ['Electronics', 'Accessories', 'Computers', 'Audio'];
            const regions = ['North', 'South', 'East', 'West'];
            
            rawData = [];
            for (let i = 0; i < 1000; i++) {
                rawData.push({
                    id: i + 1,
                    product: products[Math.floor(Math.random() * products.length)],
                    category: categories[Math.floor(Math.random() * categories.length)],
                    price: Math.round((Math.random() * 2000 + 100) * 100) / 100,
                    quantity: Math.floor(Math.random() * 50) + 1,
                    region: regions[Math.floor(Math.random() * regions.length)],
                    date: new Date(2024, Math.floor(Math.random() * 12), Math.floor(Math.random() * 28) + 1).toISOString().split('T')[0]
                });
            }
            
            document.getElementById('ingestBtn').disabled = false;
            document.getElementById('ingestOutput').textContent = `Generated ${rawData.length} sample records\nColumns: ${Object.keys(rawData[0]).join(', ')}`;
            log(`Generated ${rawData.length} sample records`);
        }
        
        // Handle CSV file upload
        document.getElementById('csvFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                log(`Loading CSV file: ${file.name}`);
                Papa.parse(file, {
                    header: true,
                    dynamicTyping: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        rawData = results.data;
                        document.getElementById('ingestBtn').disabled = false;
                        document.getElementById('ingestOutput').textContent = `Loaded ${rawData.length} records from ${file.name}\nColumns: ${Object.keys(rawData[0] || {}).join(', ')}`;
                        log(`Successfully loaded ${rawData.length} records`);
                    },
                    error: function(error) {
                        log(`Error loading CSV: ${error.message}`);
                    }
                });
            }
        });
        
        // STAGE 1: Data Ingestion
        function ingestData() {
            log('Starting data ingestion process...');
            updateProgress('ingestProgress', 0);
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += 20;
                updateProgress('ingestProgress', progress);
                
                if (progress >= 100) {
                    clearInterval(interval);
                    document.getElementById('cleanBtn').disabled = false;
                    document.getElementById('ingestOutput').textContent += `\n\nIngestion Complete!\nValidated ${rawData.length} records\nData integrity: OK`;
                    log('Data ingestion completed successfully');
                }
            }, 200);
        }
        
        // STAGE 2: Data Transformation
        function cleanData() {
            log('Cleaning data - removing nulls, duplicates...');
            updateProgress('transformProgress', 25);
            
            // Simulate data cleaning
            cleanedData = rawData.filter(row => {
                return Object.values(row).every(val => val !== null && val !== undefined && val !== '');
            });
            
            // Remove duplicates based on ID
            const seen = new Set();
            cleanedData = cleanedData.filter(row => {
                if (seen.has(row.id)) return false;
                seen.add(row.id);
                return true;
            });
            
            document.getElementById('normalizeBtn').disabled = false;
            document.getElementById('transformOutput').textContent = `Data Cleaning Complete:\nOriginal records: ${rawData.length}\nCleaned records: ${cleanedData.length}\nRemoved: ${rawData.length - cleanedData.length} invalid/duplicate records`;
            log(`Data cleaning complete: ${cleanedData.length} valid records`);
        }
        
        function normalizeData() {
            log('Normalizing numerical features...');
            updateProgress('transformProgress', 50);
            
            // Calculate price statistics for normalization
            const prices = cleanedData.map(row => row.price);
            const priceMin = Math.min(...prices);
            const priceMax = Math.max(...prices);
            
            cleanedData.forEach(row => {
                row.price_normalized = (row.price - priceMin) / (priceMax - priceMin);
                row.total_value = row.price * row.quantity;
            });
            
            document.getElementById('featureBtn').disabled = false;
            document.getElementById('transformOutput').textContent += `\n\nNormalization Complete:\nPrice range: $${priceMin} - $${priceMax}\nAdded normalized price column\nAdded total_value feature`;
            log('Data normalization completed');
        }
        
        function createFeatures() {
            log('Engineering new features...');
            updateProgress('transformProgress', 100);
            
            transformedData = cleanedData.map(row => ({
                ...row,
                price_category: row.price > 1000 ? 'Premium' : row.price > 500 ? 'Mid-range' : 'Budget',
                season: new Date(row.date).getMonth() < 3 ? 'Q1' : 
                       new Date(row.date).getMonth() < 6 ? 'Q2' :
                       new Date(row.date).getMonth() < 9 ? 'Q3' : 'Q4',
                high_value: row.total_value > 2000
            }));
            
            document.getElementById('exploreBtn').disabled = false;
            document.getElementById('transformOutput').textContent += `\n\nFeature Engineering Complete:\nAdded price_category\nAdded seasonal features\nAdded high_value flag\nReady for analysis!`;
            log('Feature engineering completed - data ready for analysis');
        }
        
        // STAGE 3: Data Analysis
        function exploreData() {
            log('Exploring data patterns and distributions...');
            updateProgress('analyzeProgress', 33);
            
            // Calculate basic statistics
            const totalRevenue = transformedData.reduce((sum, row) => sum + row.total_value, 0);
            const avgOrderValue = totalRevenue / transformedData.length;
            const uniqueProducts = new Set(transformedData.map(row => row.product)).size;
            const topRegion = Object.entries(
                transformedData.reduce((acc, row) => {
                    acc[row.region] = (acc[row.region] || 0) + 1;
                    return acc;
                }, {})
            ).sort((a, b) => b[1] - a[1])[0][0];
            
            analysisResults = {
                totalRevenue,
                avgOrderValue,
                uniqueProducts,
                topRegion,
                totalOrders: transformedData.length
            };
            
            displayAnalysisMetrics();
            document.getElementById('visualizeBtn').disabled = false;
            log('Data exploration completed');
        }
        
        function displayAnalysisMetrics() {
            const container = document.getElementById('analysisMetrics');
            container.innerHTML = `
                <div class="metric">
                    <div class="metric-value">$${Math.round(analysisResults.totalRevenue).toLocaleString()}</div>
                    <div class="metric-label">Total Revenue</div>
                </div>
                <div class="metric">
                    <div class="metric-value">$${Math.round(analysisResults.avgOrderValue)}</div>
                    <div class="metric-label">Avg Order Value</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${analysisResults.uniqueProducts}</div>
                    <div class="metric-label">Unique Products</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${analysisResults.topRegion}</div>
                    <div class="metric-label">Top Region</div>
                </div>
            `;
        }
        
        function visualizeData() {
            log('Creating data visualizations...');
            updateProgress('analyzeProgress', 66);
            
            // Revenue by category chart
            const categoryRevenue = transformedData.reduce((acc, row) => {
                acc[row.category] = (acc[row.category] || 0) + row.total_value;
                return acc;
            }, {});
            
            const ctx = document.getElementById('analysisChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categoryRevenue),
                    datasets: [{
                        data: Object.values(categoryRevenue),
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#f5576c'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: 'Revenue by Category'
                        }
                    }
                }
            });
            
            document.getElementById('statsBtn').disabled = false;
            log('Data visualizations created');
        }
        
        function generateStats() {
            log('Performing statistical analysis...');
            updateProgress('analyzeProgress', 100);
            
            // Calculate correlations and insights
            const priceQuantityCorr = calculateCorrelation(
                transformedData.map(row => row.price),
                transformedData.map(row => row.quantity)
            );
            
            analysisResults.priceQuantityCorr = priceQuantityCorr;
            analysisResults.highValueOrders = transformedData.filter(row => row.high_value).length;
            
            document.getElementById('prepareBtn').disabled = false;
            log(`Statistical analysis complete. Price-Quantity correlation: ${priceQuantityCorr.toFixed(3)}`);
        }
        
        // STAGE 4: ML Modeling
        function prepareModel() {
            log('Preparing data for machine learning...');
            updateProgress('modelProgress', 25);
            
            // Feature preparation for simple linear regression (price prediction)
            modelResults.features = transformedData.map(row => ({
                quantity: row.quantity,
                category_encoded: ['Electronics', 'Accessories', 'Computers', 'Audio'].indexOf(row.category),
                region_encoded: ['North', 'South', 'East', 'West'].indexOf(row.region),
                target: row.price
            }));
            
            // Split data (80/20)
            const splitIndex = Math.floor(modelResults.features.length * 0.8);
            modelResults.trainData = modelResults.features.slice(0, splitIndex);
            modelResults.testData = modelResults.features.slice(splitIndex);
            
            document.getElementById('trainBtn').disabled = false;
            log(`Model preparation complete. Training set: ${modelResults.trainData.length}, Test set: ${modelResults.testData.length}`);
        }
        
        function trainModel() {
            log('Training linear regression model...');
            updateProgress('modelProgress', 75);
            
            // Simple linear regression implementation
            const X = modelResults.trainData.map(row => row.quantity);
            const Y = modelResults.trainData.map(row => row.target);
            
            const n = X.length;
            const sumX = X.reduce((a, b) => a + b, 0);
            const sumY = Y.reduce((a, b) => a + b, 0);
            const sumXY = X.reduce((sum, x, i) => sum + x * Y[i], 0);
            const sumXX = X.reduce((sum, x) => sum + x * x, 0);
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            
            modelResults.model = { slope, intercept };
            
            document.getElementById('evaluateBtn').disabled = false;
            log(`Model training complete. Slope: ${slope.toFixed(3)}, Intercept: ${intercept.toFixed(3)}`);
        }
        
        function evaluateModel() {
            log('Evaluating model performance...');
            updateProgress('modelProgress', 100);
            
            // Make predictions on test set
            const predictions = modelResults.testData.map(row => 
                modelResults.model.slope * row.quantity + modelResults.model.intercept
            );
            
            const actuals = modelResults.testData.map(row => row.target);
            
            // Calculate metrics
            const mse = predictions.reduce((sum, pred, i) => 
                sum + Math.pow(pred - actuals[i], 2), 0) / predictions.length;
            const rmse = Math.sqrt(mse);
            const mae = predictions.reduce((sum, pred, i) => 
                sum + Math.abs(pred - actuals[i]), 0) / predictions.length;
            
            modelResults.metrics = { mse, rmse, mae };
            
            displayModelMetrics();
            createModelChart(predictions, actuals);
            
            log(`Model evaluation complete. RMSE: ${rmse.toFixed(2)}, MAE: ${mae.toFixed(2)}`);
            log('üéâ Data pipeline completed successfully!');
        }
        
        function displayModelMetrics() {
            const container = document.getElementById('modelMetrics');
            container.innerHTML = `
                <div class="metric">
                    <div class="metric-value">${Math.round(modelResults.metrics.rmse)}</div>
                    <div class="metric-label">RMSE</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${Math.round(modelResults.metrics.mae)}</div>
                    <div class="metric-label">MAE</div>
                </div>
                <div class="metric">
                    <div class="metric-value">${modelResults.testData.length}</div>
                    <div class="metric-label">Test Samples</div>
                </div>
            `;
        }
        
        function createModelChart(predictions, actuals) {
            const ctx = document.getElementById('modelChart').getContext('2d');
            new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Predictions vs Actuals',
                        data: predictions.map((pred, i) => ({ x: actuals[i], y: pred })),
                        backgroundColor: '#667eea',
                        borderColor: '#764ba2'
                    }, {
                        label: 'Perfect Prediction',
                        data: [
                            { x: Math.min(...actuals), y: Math.min(...actuals) },
                            { x: Math.max(...actuals), y: Math.max(...actuals) }
                        ],
                        type: 'line',
                        borderColor: '#e53e3e',
                        backgroundColor: 'transparent',
                        borderDash: [5, 5]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Model Predictions vs Actual Values'
                        }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Actual Price' }},
                        y: { title: { display: true, text: 'Predicted Price' }}
                    }
                }
            });
        }
        
        // Utility function for correlation calculation
        function calculateCorrelation(x, y) {
            const n = x.length;
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
            const sumXX = x.reduce((sum, xi) => sum + xi * xi, 0);
            const sumYY = y.reduce((sum, yi) => sum + yi * yi, 0);
            
            const numerator = n * sumXY - sumX * sumY;
            const denominator = Math.sqrt((n * sumXX - sumX * sumX) * (n * sumYY - sumY * sumY));
            
            return denominator === 0 ? 0 : numerator / denominator;
        }
    </script>
</body>
</html>